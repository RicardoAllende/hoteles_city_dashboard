¿Qué puesto tiene el gerente de hotel?
   Gerente de Ventas
-> Gerente General
   Gerente Operativo
   GTE. UNICO HOT.






Región                  dashboard_region    (Tabla creada)
Unidad operativa        intitution          También llamada propiedad en calificaciones (hoteles)
Puesto                  department          

Tipos de usuarios

Directores regionales                           --pendiente--
Gerente de hoteles                              institution = "Gerentes Generales"
Gerente de Aprendizaje Organizacional           Rol "AO"
Coordinadores de Aprendizaje Organizacional     Rol "AO"
Personal de E-learning                          --?--
Otros que requieren acceso                      Proponer
Administrador del dashboard                     Administrador del sistema


Permisos





function local_hoteles_city_dashboard_count_enrolled_users_in_several_courses($courses, array $params = array()){
// function local_hoteles_city_dashboard_get_userids_with_params_several_courses($courses, array $params = array(), string $fieldname = ''){
    $whereClauses = array(); // Aplicables sobre campos de la tabla user
    $whereinClauses = array(); // Aplicables sobre campos de usuario personalizados
    $whereParams = array();

    $fecha_inicial = local_hoteles_city_dashboard_get_value_from_params($params, 'fecha_inicial');
    $fecha_final = local_hoteles_city_dashboard_get_value_from_params($params, 'fecha_final');
    // Se omite $fecha_inicial debido a que si se incluye los usuarios inscritos anteriormente serían omitidos, activar si se pide explícitamente ese funcionamiento
    $ids = local_hoteles_city_dashboard_get_enrolled_users_ids($courses, '', $fecha_final, false);
    array_push($whereinClauses, $ids);
    global $DB;
    if(!empty($params)){
        $allowed_filters = local_hoteles_city_dashboard_get_allowed_filters();
        foreach ($params as $key => $value) {
            // if(in_array($ke))
            if(empty($value) && $value != ''){
                if($value != ''){ // '' Podría ser un valor esperado, no así un arreglo vacío
                    continue;
                }
            }
            if(!in_array($key, $allowed_filters->filters)){
                continue;
            }
            list($insql, $inparams) = $DB->get_in_or_equal($value);
            $whereParams = array_merge($whereParams, $inparams);
            if(in_array($key, $allowed_filters->filterdefaultfields )){
                $where = " {$key} {$insql} ";
                array_push($whereClauses, $where);
            }
            if(in_array($key, $allowed_filters->filtercustomfields)){
                $fieldid = str_replace(local_hoteles_city_dashboard_filter_prefix_custom_field, '', $key);
                $where = " (SELECT DISTINCT userid FROM {user_info_data} WHERE fieldid = {$fieldid} AND value {$insql}) ";
                array_push($whereinClauses, $where);
            }
        }
    }
    $response = new stdClass();
    $response->default_filters = $whereClauses;
    $response->custom_filters = $whereinClauses;
    // $response->filters = $filters_sql;
    $response->params = $whereParams;

    $whereids = local_hoteles_city_dashboard_get_whereids_clauses($response, '_us_.id');
    _log($whereids);
    $query = "SELECT count(*) FROM {user} as _us_ WHERE 1 = 1 {$whereids}";
    _sql($query, $response->params, 'Inscritos');
    // return $DB->count_records_sql($query, $response->params);
    

    // return $response;
}